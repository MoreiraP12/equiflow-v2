<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>equiflow - Equity-focused Cohort Selection Flow Diagrams</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#0d9488', // Teal-600
                            light: '#2dd4bf',  // Teal-400
                            dark: '#0f766e'   // Teal-700
                        },
                        secondary: '#f59e0b', // Amber-500
                        accent: '#6366f1',   // Indigo-500
                        neutral: {
                            light: '#f9fafb', // Gray-50 (Slightly off-white for alternates)
                            DEFAULT: '#6b7280', // Gray-500
                            dark: '#1f2937'  // Gray-800
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Base body background */
        body {
            background-color: #ffffff; /* White base */
        }
        /* Style for Highlight.js code blocks */
        pre {
            position: relative; /* Needed for copy button positioning */
            margin-bottom: 1.5rem;
        }
        pre code.hljs {
            display: block;
            overflow-x: auto;
            padding: 1.5em;
            background: #282c34;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            color: #abb2bf; /* Default text color for atom-one-dark */
        }
        /* Style for inline code */
        code:not(pre code) {
            background-color: #f3f4f6;
            color: #1f2937;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            border-radius: 0.25rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        /* Active state for navigation */
        nav a.active {
            color: #0d9488;
            font-weight: 600;
            position: relative;
        }
        nav a.active::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px; /* Slightly thicker */
            background-color: #0d9488;
            border-radius: 1px;
        }
        /* Style for Table of Contents links */
        .toc a {
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
            display: block; /* Ensure block for transform */
        }
        .toc a:hover {
            color: #0d9488;
            transform: translateX(2px); /* Subtle shift on hover */
        }
        .toc ul ul a {
            padding-left: 0.5rem; /* Indent sub-items more */
        }
        .toc ul ul a::before {
            content: "â†³"; /* Indicate sub-item */
            margin-right: 0.3rem;
            opacity: 0.6;
        }
        /* Sticky elements */
        .sticky-nav {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent white */
            backdrop-filter: blur(8px); /* Frosted glass effect */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.07), 0 1px 2px -1px rgba(0, 0, 0, 0.07);
        }
        .sticky-toc {
            position: sticky;
            top: 90px; /* Adjust based on nav height + buffer */
            z-index: 40;
            max-height: calc(100vh - 120px); /* Limit height and allow scroll */
            overflow-y: auto;
        }
        /* Scroll animation base state */
        .scroll-animate {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .scroll-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* Copy button styles */
        .copy-button {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            background-color: rgba(255, 255, 255, 0.1);
            color: #abb2bf;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.375rem;
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            opacity: 0.7;
            z-index: 10; /* Ensure button is clickable */
        }
        .copy-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            opacity: 1;
        }
        .copy-button.copied {
            background-color: #0d9488; /* Primary color */
            color: white;
            border-color: #0d9488;
        }
        .copy-button .lucide { /* Style icon inside button */
            width: 1em;
            height: 1em;
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.25em;
        }

        /* Alternating section backgrounds */
        section:nth-child(odd) {
             background-color: #f9fafb; /* neutral-light (Gray-50) */
        }
         section:nth-child(even) {
             background-color: #ffffff; /* white */
        }
         /* Override for first section if needed, or adjust logic */
         #overview {
             background-color: #ffffff;
         }

    </style>
</head>
<body class="font-sans text-neutral-dark antialiased">

    <header class="bg-gradient-to-br from-primary-dark via-primary to-primary-light text-white py-20 md:py-28 relative overflow-hidden">
        <div class="absolute inset-0 opacity-[0.03]" style="background-image: url('data:image/svg+xml,%3Csvg width=%2252%22 height=%2226%22 viewBox=%220 0 52 26%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cg fill=%22white%22 fill-opacity=%221%22%3E%3Cpath d=%22M10 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4v2c-3.314 0-6-2.686-6-6 0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6zm25.464-1.95l8.486 8.486-1.414 1.414-8.486-8.486 1.414-1.414zM31 6c-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4s4-1.79 4-4h2c0 3.314-2.686 6-6 6z%22/%3E%3C/g%3E%3C/svg%3E');"></div>
        <div class="container mx-auto px-6 text-center relative z-10">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight">equiflow</h1>
            <p class="text-lg md:text-2xl opacity-90 max-w-3xl mx-auto mb-8">Equity-focused Cohort Selection Flow Diagrams for transparent and reproducible research</p>
            <div class="flex flex-wrap justify-center gap-3 mb-10">
                <span class="bg-white/20 backdrop-blur-sm text-white text-xs font-semibold px-4 py-1.5 rounded-full shadow-sm">Python</span>
                <span class="bg-white/20 backdrop-blur-sm text-white text-xs font-semibold px-4 py-1.5 rounded-full shadow-sm">Machine Learning</span>
                <span class="bg-white/20 backdrop-blur-sm text-white text-xs font-semibold px-4 py-1.5 rounded-full shadow-sm">Clinical Research</span>
                <span class="bg-white/20 backdrop-blur-sm text-white text-xs font-semibold px-4 py-1.5 rounded-full shadow-sm">Data Visualization</span>
            </div>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#installation" class="inline-block px-8 py-3 bg-white text-primary-dark font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl">
                    Get Started
                </a>
                <a href="https://github.com/yourusername/equiflow" target="_blank" rel="noopener noreferrer" class="inline-block px-8 py-3 bg-transparent border-2 border-white text-white font-semibold rounded-lg hover:bg-white/10 transition duration-300 ease-in-out transform hover:-translate-y-0.5">
                    View on GitHub <i data-lucide="external-link" class="inline-block w-4 h-4 ml-1 -mt-1"></i>
                </a>
            </div>
        </div>
    </header>

    <nav class="sticky-nav">
        <div class="container mx-auto px-6">
            <ul class="flex flex-wrap items-center justify-center md:justify-start list-none -mb-px">
                <li><a href="#overview" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">Overview</a></li>
                <li><a href="#installation" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">Installation</a></li>
                <li><a href="#usage" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">Usage</a></li>
                <li><a href="#api" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">API Reference</a></li>
                <li><a href="#examples" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">Examples</a></li>
                <li><a href="#motivation" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">Motivation</a></li>
                <li><a href="#citation" class="inline-block text-neutral-dark hover:text-primary px-4 py-4 text-sm font-medium transition duration-150 ease-in-out">Citation</a></li>
            </ul>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-12">
        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-md mb-12 shadow-sm flex items-center gap-3 scroll-animate">
             <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-600"></i>
             <div>
                <p class="font-bold">Under Construction</p>
                <p class="text-sm">This package is currently in active development. Features may change.</p>
             </div>
        </div>

        <div class="lg:grid lg:grid-cols-4 lg:gap-12">

            <div class="lg:col-span-3 space-y-12">

                <section id="overview" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                    <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3">
                        <i data-lucide="layout-grid" class="w-7 h-7 text-primary"></i> Overview
                    </h2>
                    <p class="mb-5 text-neutral leading-relaxed"><strong>equiflow</strong> is a Python package designed to generate "Equity-focused Cohort Selection Flow Diagrams". Our goal is to streamline research workflows, enhance reproducibility, and improve the transparency of cohort curation, particularly in machine learning studies.</p>
                    <h3 class="text-xl font-semibold text-neutral-dark mt-8 mb-4 flex items-center gap-2">
                         <i data-lucide="eye" class="w-5 h-5 text-primary/80"></i> Vision
                    </h3>
                    <p class="mb-5 text-neutral leading-relaxed"><strong>equiflow</strong> provides both tabular and visual summaries of inclusion/exclusion criteria applied to clinical datasets. Crucially, each step can optionally display cohort composition across key demographics or outcomes, enabling researchers to interrogate potential sampling biases introduced during selection.</p>
                    <p class="mb-8 text-neutral leading-relaxed">This tool aims to bolster transparency and reproducibility in medical AI/ML research, complementing established tools like <code>tableone</code> for population summary statistics.</p>
                    <img src="https://placehold.co/800x400/0d9488/white?text=Example+EquiFlow+Diagram" alt="Flow Diagram Example" class="block max-w-full h-auto my-10 rounded-lg shadow-lg border border-gray-200 mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-10">
                        <div class="bg-white p-6 rounded-lg border border-gray-100 shadow-sm transition duration-300 ease-in-out hover:shadow-lg transform hover:-translate-y-1"><i data-lucide="git-merge" class="w-8 h-8 text-primary mb-3"></i><h3 class="text-lg font-semibold text-primary mb-2">Cohort Flow Visualization</h3><p class="text-sm text-neutral leading-relaxed">Generate clear flow diagrams detailing cohort sizes, exclusion criteria, and optional variable distributions at each step.</p></div>
                        <div class="bg-white p-6 rounded-lg border border-gray-100 shadow-sm transition duration-300 ease-in-out hover:shadow-lg transform hover:-translate-y-1"><i data-lucide="pie-chart" class="w-8 h-8 text-primary mb-3"></i><h3 class="text-lg font-semibold text-primary mb-2">Distribution Analysis</h3><p class="text-sm text-neutral leading-relaxed">Analyze categorical, normal, non-normal continuous variables, and missing data patterns across cohorts.</p></div>
                        <div class="bg-white p-6 rounded-lg border border-gray-100 shadow-sm transition duration-300 ease-in-out hover:shadow-lg transform hover:-translate-y-1"><i data-lucide="move-horizontal" class="w-8 h-8 text-primary mb-3"></i><h3 class="text-lg font-semibold text-primary mb-2">Distribution Drift Measurement</h3><p class="text-sm text-neutral leading-relaxed">Quantify cohort changes using Standardized Mean Differences (SMDs) to highlight potential selection biases.</p></div>
                        <div class="bg-white p-6 rounded-lg border border-gray-100 shadow-sm transition duration-300 ease-in-out hover:shadow-lg transform hover:-translate-y-1"><i data-lucide="table-2" class="w-8 h-8 text-primary mb-3"></i><h3 class="text-lg font-semibold text-primary mb-2">Tabular Representations</h3><p class="text-sm text-neutral leading-relaxed">Output detailed tables of flows, characteristics, and distribution shifts suitable for reporting and analysis.</p></div>
                    </div>
                </section>

                <section id="installation" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                     <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3"><i data-lucide="download" class="w-7 h-7 text-primary"></i> Installation</h2>
                    <p class="mb-4 text-neutral leading-relaxed">Install <code>equiflow</code> directly from PyPI using pip:</p>
                    <pre><code class="language-bash hljs">pip install equiflow</code></pre>
                    <h3 class="text-xl font-semibold text-neutral-dark mt-8 mb-4 flex items-center gap-2"><i data-lucide="puzzle" class="w-5 h-5 text-primary/80"></i> Dependencies</h3>
                    <p class="mb-3 text-neutral leading-relaxed"><code>equiflow</code> relies on the following core Python libraries:</p>
                    <ul class="list-disc list-inside space-y-1.5 text-neutral ml-4"><li><code>pandas</code> (for data manipulation)</li><li><code>numpy</code> (for numerical operations)</li><li><code>matplotlib</code> (for plotting distributions within diagrams)</li><li><code>graphviz</code> (for rendering the flow diagrams - requires separate system installation)</li></ul>
                     <p class="mt-4 text-sm text-neutral-dark bg-blue-50 p-3 rounded-md border border-blue-200"><i data-lucide="info" class="inline-block w-4 h-4 mr-1 -mt-1 text-blue-600"></i> Ensure the <a href="https://graphviz.org/download/" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-medium">Graphviz executable</a> is installed on your system and added to your PATH environment variable for diagram generation to work.</p>
                </section>

                <section id="usage" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                     <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3"><i data-lucide="terminal-square" class="w-7 h-7 text-primary"></i> Basic Usage</h2>
                    <p class="mb-5 text-neutral leading-relaxed">Here's a foundational example demonstrating how to use the primary <code>EquiFlow</code> class:</p>
                    <pre><code class="language-python hljs">from equiflow import EquiFlow
import pandas as pd

# --- 1. Prepare your data ---
# Assume 'your_dataframe' is a pandas DataFrame loaded with patient data
# Example: your_dataframe = pd.read_csv('path/to/your/data.csv')

# --- 2. Initialize EquiFlow ---
# Specify your data and define variable types for analysis
flow = EquiFlow(
    data=your_dataframe,
    categorical=['sex', 'race', 'insurance_type'], # Variables treated as categories
    normal=['age', 'bmi'], # Continuous variables assumed ~normally distributed
    nonnormal=['lab_value_x', 'length_of_stay'], # Continuous variables not normally distributed
    initial_cohort_label="Total Screened Patients" # Label for the starting point
)

# --- 3. Add Exclusion Steps ---
# Apply criteria sequentially. The 'mask' should select rows to KEEP.
flow.add_exclusion(
    mask=(your_dataframe['age'] >= 18), # Keep rows where age is 18 or older
    exclusion_reason="Excluded: Age < 18 years", # Label for the arrow/edge
    new_cohort_label="Adult Patients (>=18 years)" # Label for the resulting node
)

flow.add_exclusion(
    mask=(your_dataframe['has_complete_records'] == True), # Keep rows with complete records
    exclusion_reason="Excluded: Incomplete Records",
    new_cohort_label="Patients with Complete Records"
)

# --- 4. View Output Tables ---
# Access the generated summary tables
print("--- Flow Summary Table ---")
flow_table = flow.view_table_flows()
print(flow_table)

print("\n--- Cohort Characteristics Table ---")
characteristics_table = flow.view_table_characteristics(decimals=1) # Control decimal places
print(characteristics_table)

print("\n--- Distribution Drifts (SMD) Table ---")
drifts_table = flow.view_table_drifts(decimals=3) # Control decimal places
print(drifts_table)

# --- 5. Generate Flow Diagram ---
# Render and save the visual diagram (requires Graphviz)
try:
    flow.plot_flows(
        output_file="patient_selection_flow", # Base name for output file
        format="png", # Specify format (png, pdf, svg, etc.)
        plot_dists=True, # Include mini distribution plots in nodes
        smds=True # Show SMDs on the edges
    )
    print(f"\nFlow diagram saved as patient_selection_flow.png")
except ImportError as e:
     print(f"\nError: {e}. Could not generate plot. Is Graphviz Python library installed (`pip install graphviz`)?")
except FileNotFoundError as e:
    print(f"\nError: {e}. Graphviz executable not found. Is it installed and in your system PATH?")
except Exception as e:
    print(f"\nAn unexpected error occurred during plotting: {e}")
                    </code></pre>
                    <h3 class="text-xl font-semibold text-neutral-dark mt-10 mb-4 flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5 text-primary/80"></i> Using <code>EasyFlow</code> for Simplicity</h3>
                    <p class="mb-5 text-neutral leading-relaxed">For quicker workflows with less customization, the <code>EasyFlow</code> class offers a streamlined interface:</p>
                    <pre><code class="language-python hljs">from equiflow import EasyFlow
import pandas as pd

# Assume 'your_dataframe' is loaded

# --- 1. Initialize EasyFlow ---
# Auto-detects variable types by default
flow = EasyFlow(your_dataframe, title="Simplified Patient Selection")

# --- 2. Add Exclusion Steps ---
# Use the 'exclude' method (condition selects rows to KEEP)
flow.exclude(your_dataframe['age'] >= 18, "Keep: Age >= 18 years")
flow.exclude(your_dataframe['has_complete_records'] == True, "Keep: Complete Records")

# --- 3. Generate Outputs ---
# Creates diagram and prints tables in one go
try:
    flow.generate(
        output="patient_selection_easyflow", # Base filename
        format="png",
        show=True # Print tables to console
    )
    print("\nEasyFlow outputs generated successfully.")
except Exception as e:
    # Handle potential Graphviz errors similarly to above
    print(f"\nError generating EasyFlow outputs: {e}")

                    </code></pre>
                </section>

                <section id="api" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                    <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3"><i data-lucide="book-open" class="w-7 h-7 text-primary"></i> API Reference</h2>
                    <h3 class="text-2xl font-semibold text-neutral-dark mt-6 mb-5"><code>EquiFlow</code> Class</h3>
                    <p class="mb-6 text-neutral leading-relaxed">The primary class offering detailed control over diagram generation and analysis.</p>
                    <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="constructor" class="w-4 h-4 opacity-80"></i> <code>EquiFlow.__init__(...)</code></h4><p class="text-sm text-neutral mb-3">Initializes the EquiFlow object with data and variable definitions.</p><p class="text-sm font-medium text-neutral-dark mb-1">Key Parameters:</p><ul class="list-disc list-inside space-y-1 text-sm text-neutral ml-4"><li><code>data: pd.DataFrame</code> - The initial cohort dataset.</li><li><code>categorical: list[str]</code> - List of categorical variable names.</li><li><code>normal: list[str]</code> - List of normally distributed continuous variable names.</li><li><code>nonnormal: list[str]</code> - List of non-normally distributed continuous variable names.</li><li><code>initial_cohort_label: str</code> - Label for the starting node.</li><li><code>index: str</code> (optional) - Name of the unique patient identifier column.</li></ul></div>
                    <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="filter" class="w-4 h-4 opacity-80"></i> <code>add_exclusion(...)</code></h4><p class="text-sm text-neutral mb-3">Adds a sequential exclusion step to the flow.</p><p class="text-sm font-medium text-neutral-dark mb-1">Key Parameters:</p><ul class="list-disc list-inside space-y-1 text-sm text-neutral ml-4"><li><code>mask: pd.Series[bool]</code> - Boolean mask indicating which rows to **keep**.</li><li><code>exclusion_reason: str</code> - Text label for the edge representing the exclusion.</li><li><code>new_cohort_label: str</code> - Text label for the node representing the cohort after exclusion.</li></ul></div>
                     <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="table" class="w-4 h-4 opacity-80"></i> <code>view_table_flows(...)</code></h4><p class="text-sm text-neutral mb-3">Generates a pandas DataFrame summarizing cohort sizes at each step.</p><p class="text-sm font-medium text-neutral-dark mb-1">Returns:</p><p class="text-sm text-neutral ml-4"><code>pd.DataFrame</code> - Table showing 'Initial N', 'Removed N', and 'Result N'.</p></div>
                     <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="table-properties" class="w-4 h-4 opacity-80"></i> <code>view_table_characteristics(...)</code></h4><p class="text-sm text-neutral mb-3">Generates a DataFrame showing variable characteristics (e.g., counts, percentages, means) for each cohort.</p><p class="text-sm font-medium text-neutral-dark mb-1">Returns:</p><p class="text-sm text-neutral ml-4"><code>pd.DataFrame</code> - Detailed table of cohort characteristics.</p></div>
                     <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="arrow-left-right" class="w-4 h-4 opacity-80"></i><code>view_table_drifts(...)</code></h4><p class="text-sm text-neutral mb-3">Generates a DataFrame showing Standardized Mean Differences (SMDs) between consecutive cohorts.</p><p class="text-sm font-medium text-neutral-dark mb-1">Returns:</p><p class="text-sm text-neutral ml-4"><code>pd.DataFrame</code> - Table of SMDs for assessing distribution shifts.</p></div>
                    <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="image" class="w-4 h-4 opacity-80"></i> <code>plot_flows(...)</code></h4><p class="text-sm text-neutral mb-3">Renders and saves the flow diagram visualization using Graphviz.</p><p class="text-sm font-medium text-neutral-dark mb-1">Key Parameters:</p><ul class="list-disc list-inside space-y-1 text-sm text-neutral ml-4"><li><code>output_file: str</code> - Base name for the output file (e.g., "my_flow").</li><li><code>format: str</code> - Output format ('pdf', 'png', 'svg', etc.).</li><li><code>plot_dists: bool</code> - If True, include distribution plots in nodes.</li><li><code>smds: bool</code> - If True, display SMDs on edges.</li><li><code>legend: bool</code> - If True, add a legend for distribution plots.</li><li>Numerous optional styling parameters (colors, fonts, sizes).</li></ul></div>
                    <h3 class="text-2xl font-semibold text-neutral-dark mt-12 mb-5"><code>EasyFlow</code> Class</h3>
                    <p class="mb-6 text-neutral leading-relaxed">A high-level wrapper for simplified diagram creation with sensible defaults.</p>
                     <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="constructor" class="w-4 h-4 opacity-80"></i> <code>EasyFlow.__init__(...)</code></h4><p class="text-sm text-neutral mb-3">Initializes EasyFlow, typically auto-detecting variable types.</p><p class="text-sm font-medium text-neutral-dark mb-1">Key Parameters:</p><ul class="list-disc list-inside space-y-1 text-sm text-neutral ml-4"><li><code>data: pd.DataFrame</code> - The initial dataset.</li><li><code>title: str</code> - Optional title for the diagram.</li><li><code>auto_detect: bool</code> - If True (default), attempts to infer variable types.</li></ul></div>
                    <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="filter-x" class="w-4 h-4 opacity-80"></i> <code>exclude(...)</code></h4><p class="text-sm text-neutral mb-3">Adds an exclusion step based on a boolean condition.</p><p class="text-sm font-medium text-neutral-dark mb-1">Key Parameters:</p><ul class="list-disc list-inside space-y-1 text-sm text-neutral ml-4"><li><code>condition: pd.Series[bool]</code> - Boolean mask selecting rows to **keep**.</li><li><code>label: str</code> - Label describing the inclusion criteria or cohort.</li></ul></div>
                     <div class="method-doc border border-gray-200 rounded-lg p-5 mb-6 bg-white shadow-sm"><h4 class="text-lg font-semibold font-mono text-primary mb-2 flex items-center gap-2"><i data-lucide="play-circle" class="w-4 h-4 opacity-80"></i> <code>generate(...)</code></h4><p class="text-sm text-neutral mb-3">Generates the flow diagram and optionally prints summary tables.</p><p class="text-sm font-medium text-neutral-dark mb-1">Key Parameters:</p><ul class="list-disc list-inside space-y-1 text-sm text-neutral ml-4"><li><code>output: str</code> - Base name for the output diagram file.</li><li><code>show: bool</code> - If True (default), print tables to console.</li><li><code>format: str</code> - Output format for the diagram ('pdf', 'png', etc.).</li></ul></div>
                </section>

                <section id="examples" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                     <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3"><i data-lucide="lightbulb" class="w-7 h-7 text-primary"></i> Examples</h2>
                    <h3 class="text-xl font-semibold text-neutral-dark mt-6 mb-4 flex items-center gap-2"><i data-lucide="sliders-horizontal" class="w-5 h-5 text-primary/80"></i> Customizing Variable Types (EasyFlow)</h3>
                    <p class="mb-5 text-neutral leading-relaxed">Override automatic type detection if needed using chainable methods.</p>
                    <pre><code class="language-python hljs"># Assume 'patient_data' is a pandas DataFrame
flow = EasyFlow(patient_data, title="Patient Screening Flow")

# Explicitly set variable types *before* adding exclusions
flow.categorize(['sex', 'race', 'insurance_type']) \
    .measure_normal(['age', 'weight', 'height']) \
    .measure_nonnormal(['hospital_stay_days', 'num_previous_admissions'])

# Now add exclusions
flow.exclude(patient_data['age'] >= 18, "Keep: Age >= 18 years")
flow.exclude(patient_data['has_complete_data'] == True, "Keep: Complete data")

# Generate outputs
flow.generate(output="custom_vars_flow", format="png")
                    </code></pre>
                    <h3 class="text-xl font-semibold text-neutral-dark mt-10 mb-4 flex items-center gap-2"><i data-lucide="fast-forward" class="w-5 h-5 text-primary/80"></i> Quickly Creating a Flow Diagram (Class Method)</h3>
                     <p class="mb-5 text-neutral leading-relaxed">Use the <code>EasyFlow.quick_flow</code> class method for the most concise way to generate a standard diagram.</p>
                    <pre><code class="language-python hljs"># Define exclusions as a list of (condition_to_keep, label) tuples
exclusions_list = [
    (patient_data['age'] >= 18, "Keep: Age >= 18 years"),
    (patient_data['has_complete_data'] == True, "Keep: Complete data"),
    (patient_data['followup_duration'] >= 365, "Keep: >= 1 year follow-up")
]

# Create flow diagram and generate outputs with one class method call
try:
    EasyFlow.quick_flow(
        data=patient_data,
        exclusions=exclusions_list,
        output="patient_quick_flow", # Output filename base
        format="svg", # Save as SVG
        title="Rapid Patient Flow Diagram"
    )
    print("\nQuick flow diagram generated.")
except Exception as e:
    print(f"\nError generating quick flow: {e}") # Handle potential errors
                    </code></pre>
                    <h3 class="text-xl font-semibold text-neutral-dark mt-10 mb-4 flex items-center gap-2"><i data-lucide="palette" class="w-5 h-5 text-primary/80"></i> Advanced Plot Customization (EquiFlow)</h3>
                     <p class="mb-5 text-neutral leading-relaxed">Leverage the extensive options in <code>EquiFlow.plot_flows()</code> for fine-grained visual control.</p>
                    <pre><code class="language-python hljs"># Assume 'flow' is an EquiFlow instance already set up with data and exclusions
# (See Basic Usage example for setup)

# Customize plot appearance extensively
try:
    flow.plot_flows(
        output_file="custom_style_flow",
        format="svg", # Use vector format SVG
        plot_dists=True, # Show distribution plots
        smds=True, # Show SMDs
        legend=True, # Show distribution legend
        # --- Sizing ---
        box_width=3.5,
        box_height=1.5,
        # --- Colors (using hex codes or named colors) ---
        cohort_node_color="#e0f2fe", # Tailwind sky-100
        exclusion_node_color="#fee2e2", # Tailwind red-100
        categorical_bar_colors=["#60a5fa", "#f87171", "#fbbf24", "#a7f3d0"], # Example custom palette
        missing_value_color="#d1d5db", # Tailwind gray-300
        continuous_var_color="#a5f3fc", # Tailwind cyan-200
        edge_color="#6b7280", # Tailwind gray-500
        # --- Fonts ---
        font_name="Inter", # Match body font if available to Graphviz
        fontsize=10,
        # --- Other ---
        dpi=150 # Increase resolution for raster formats (like png)
    )
    print("\nCustom styled flow diagram saved as custom_style_flow.svg")
except Exception as e:
    print(f"\nError generating custom plot: {e}") # Handle potential errors

                    </code></pre>
                </section>

                <section id="motivation" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                     <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3"><i data-lucide="heart-pulse" class="w-7 h-7 text-primary"></i> Motivation & Equity Focus</h2>
                    <p class="mb-5 text-neutral leading-relaxed">Selection bias is a pervasive challenge in clinical research. It can manifest during patient recruitment, application of inclusion/exclusion criteria, or through data processing steps. This bias often leads to the underrepresentation of populations historically marginalized in medical research.</p>
                    <p class="mb-5 text-neutral leading-relaxed">When datasets affected by selection bias are used to train artificial intelligence (AI) and machine learning (ML) models, the resulting algorithms can perpetuate and even amplify existing health inequities.</p>
                     <p class="mb-5 text-neutral leading-relaxed">Inspired by initiatives like "Data Cards" and "Model Cards" promoting transparency, <code>equiflow</code> advocates for the routine creation of **participant flow diagrams that explicitly track sociodemographic** and clinical characteristics at each stage of cohort definition. This practice aims to proactively identify potential sources of bias before algorithms are deployed clinically.</p>
                    <p class="text-neutral leading-relaxed font-medium text-primary-dark">By standardizing the reporting of participant flow with an equity lens, we hope to foster the development of more reliable, transparent, and equitable clinical algorithms.</p>
                </section>

                <section id="citation" class="p-6 md:p-10 rounded-lg shadow-md scroll-mt-24 scroll-animate">
                     <h2 class="text-3xl font-semibold text-neutral-dark border-b border-gray-200 pb-4 mb-8 flex items-center gap-3"><i data-lucide="quote" class="w-7 h-7 text-primary"></i> Citation</h2>
                    <p class="mb-5 text-neutral leading-relaxed">The conceptual framework for equity-focused flow diagrams implemented in <code>equiflow</code> was introduced in:</p>
                    <div class="citation bg-white border border-gray-200 p-5 rounded-lg shadow-sm mb-6">
                        <p class="italic text-neutral-dark">Ellen JG, Matos J, Viola M, Moore J, et al. Participant flow diagrams for health equity in AI. <span class="font-medium">J Biomed Inform.</span> 2024;152:104631.</p>
                        <a href="https://doi.org/10.1016/j.jbi.2024.104631" target="_blank" rel="noopener noreferrer" class="text-primary text-sm hover:underline mt-2 inline-block">
                            DOI: 10.1016/j.jbi.2024.104631 <i data-lucide="external-link" class="inline-block w-3 h-3 ml-0.5 -mt-0.5"></i>
                        </a>
                    </div>
                    <p class="mb-5 text-neutral leading-relaxed">If you use the <code>equiflow</code> Python package in your research, please cite the software directly (details will be finalized upon official release):</p>
                    <div class="citation bg-white border border-gray-200 p-5 rounded-lg shadow-sm">
                        <p class="italic text-neutral-dark">[Placeholder: Citation details for the equiflow software package will be provided here. Please check the package documentation or repository for the official citation format upon release.]</p>
                    </div>
                </section>

            </div> <aside class="lg:col-span-1 mt-12 lg:mt-0">
                <div class="toc bg-white p-6 rounded-lg shadow-md border border-gray-100 sticky-toc">
                    <h3 class="text-lg font-semibold text-primary mb-5 flex items-center gap-2">
                         <i data-lucide="list" class="w-5 h-5"></i> Contents
                    </h3>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="#overview" class="block text-neutral hover:text-primary font-medium">Overview</a></li>
                        <li><a href="#installation" class="block text-neutral hover:text-primary font-medium">Installation</a></li>
                        <li><a href="#usage" class="block text-neutral hover:text-primary font-medium">Basic Usage</a></li>
                        <li>
                            <a href="#api" class="block text-neutral hover:text-primary font-medium">API Reference</a>
                            <ul class="ml-4 mt-2 space-y-1.5 border-l-2 border-primary/20 pl-4">
                                <li><a href="#api-equiflow" class="block text-neutral hover:text-primary text-xs">EquiFlow Class</a></li>
                                <li><a href="#api-easyflow" class="block text-neutral hover:text-primary text-xs">EasyFlow Class</a></li>
                            </ul>
                        </li>
                        <li><a href="#examples" class="block text-neutral hover:text-primary font-medium">Examples</a></li>
                        <li><a href="#motivation" class="block text-neutral hover:text-primary font-medium">Motivation</a></li>
                        <li><a href="#citation" class="block text-neutral hover:text-primary font-medium">Citation</a></li>
                    </ul>
                </div>
            </aside> </div> </main>

    <footer class="bg-neutral-dark text-neutral-light py-16 mt-20 border-t-4 border-primary">
        <div class="container mx-auto px-6 text-center">
             <i data-lucide="flask-conical" class="w-10 h-10 text-primary mx-auto mb-4"></i>
            <p class="text-sm mb-2">&copy; <span id="current-year"></span> equiflow Authors. Released under the MIT License.</p>
            <p class="text-xs opacity-70 mb-4">Documentation generated on <span id="generation-date"></span>.</p>
            <p class="text-sm mb-6">Built with <i data-lucide="heart" class="inline-block w-4 h-4 text-red-400 fill-current -mt-1"></i> for better health equity in AI</p>
            <p class="text-sm opacity-80">
                <a href="https://github.com/yourusername/equiflow" target="_blank" rel="noopener noreferrer" class="hover:text-white transition duration-150 ease-in-out border-b border-dotted border-neutral-light hover:border-white pb-px">
                    <i data-lucide="github" class="inline-block w-4 h-4 mr-1 -mt-1"></i> GitHub Repository
                </a>
            </p>
        </div>
    </footer>

    <script>
        // Wrap main script logic in a self-executing function or DOMContentLoaded listener
        // to ensure DOM is ready and scope variables.
        (function() {
            // --- Initialize Lucide Icons ---
            try {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                } else {
                    console.error("Lucide library not loaded.");
                }
            } catch (error) {
                console.error("Error initializing Lucide icons:", error);
            }

            // --- Initialize Highlight.js ---
            try {
                if (typeof hljs !== 'undefined') {
                    // Wait briefly for DOM to fully render before highlighting
                    setTimeout(() => {
                         hljs.highlightAll();
                    }, 0);
                } else {
                    console.error("Highlight.js library not loaded.");
                }
            } catch (error) {
                console.error("Error initializing Highlight.js:", error);
            }

            // --- Smooth Scrolling & Active Nav Link ---
            try {
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        const href = this.getAttribute('href');
                        try {
                            const targetElement = document.querySelector(href);
                            if (targetElement) {
                                e.preventDefault();
                                const navHeight = document.querySelector('nav')?.offsetHeight || 70;
                                const elementPosition = targetElement.getBoundingClientRect().top;
                                const offsetPosition = elementPosition + window.pageYOffset - navHeight - 20;

                                window.scrollTo({ top: offsetPosition, behavior: 'smooth' });

                                // Update active nav link immediately
                                document.querySelectorAll('nav a').forEach(link => link.classList.remove('active'));
                                const navLink = document.querySelector(`nav a[href="${href}"]`);
                                if (navLink) navLink.classList.add('active');
                            }
                        } catch (error) {
                             console.error(`Error finding or scrolling to element ${href}:`, error);
                        }
                    });
                });
            } catch (error) {
                 console.error("Error setting up smooth scroll:", error);
            }


            // --- Debounce Function ---
            function debounce(func, wait = 20, immediate = true) {
                let timeout;
                return function() {
                    const context = this, args = arguments;
                    const later = function() {
                        timeout = null;
                        if (!immediate) func.apply(context, args);
                    };
                    const callNow = immediate && !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    if (callNow) func.apply(context, args);
                };
            };

            // --- Active Nav Link on Scroll ---
            try {
                const sections = document.querySelectorAll('section[id]');
                const navLinks = document.querySelectorAll('nav a');
                if (sections.length > 0 && navLinks.length > 0) {
                    const navHeightScroll = document.querySelector('nav')?.offsetHeight || 70;

                    const activateNavOnScroll = debounce(() => {
                        let currentSectionId = '';
                        // Add a buffer to the scroll position check
                        const scrollPosition = window.pageYOffset + navHeightScroll + 50;

                        sections.forEach(section => {
                            const sectionTop = section.offsetTop;
                             // Check if the scroll position is within the section bounds (approximately)
                            if (scrollPosition >= sectionTop && scrollPosition < sectionTop + section.offsetHeight) {
                                currentSectionId = section.getAttribute('id');
                            }
                        });

                         // Fallback logic if no section is perfectly matched
                        if (!currentSectionId) {
                            // Check if near the bottom
                            if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight - 100) {
                                currentSectionId = sections[sections.length - 1].getAttribute('id');
                            }
                            // Check if near the top
                            else if (window.pageYOffset < sections[0].offsetTop - navHeightScroll - 50) {
                                 currentSectionId = sections[0].getAttribute('id');
                            }
                             // Otherwise, find the last section whose top is above the scroll position
                            else {
                                for (let i = sections.length - 1; i >= 0; i--) {
                                    if (scrollPosition >= sections[i].offsetTop) {
                                        currentSectionId = sections[i].getAttribute('id');
                                        break;
                                    }
                                }
                            }
                        }


                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${currentSectionId}`) {
                                link.classList.add('active');
                            }
                        });
                    }, 50); // Debounce time

                    window.addEventListener('scroll', activateNavOnScroll);
                    activateNavOnScroll(); // Initial check on load
                } else {
                     console.warn("Could not find sections or nav links for scrollspy.");
                }
            } catch (error) {
                console.error("Error setting up active nav on scroll:", error);
            }


            // --- Scroll Animations ---
            try {
                const animatedElements = document.querySelectorAll('.scroll-animate');
                if (animatedElements.length > 0 && typeof IntersectionObserver !== 'undefined') {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('visible');
                                // observer.unobserve(entry.target); // Optional: Keep observing
                            }
                            // Optional: Remove class if element scrolls out of view
                            // else {
                            //     entry.target.classList.remove('visible');
                            // }
                        });
                    }, {
                        threshold: 0.1 // Adjust threshold as needed
                    });

                    animatedElements.forEach(el => observer.observe(el));
                } else if (animatedElements.length === 0) {
                     console.warn("No elements found with .scroll-animate class.");
                } else {
                     console.error("IntersectionObserver not supported or not found.");
                     // Fallback for browsers without IntersectionObserver: make elements visible immediately
                     animatedElements.forEach(el => el.classList.add('visible'));
                }
            } catch (error) {
                console.error("Error setting up scroll animations:", error);
                 // Fallback in case of error: make elements visible
                 document.querySelectorAll('.scroll-animate').forEach(el => el.classList.add('visible'));
            }


            // --- Copy Code Button Functionality ---
            try {
                document.querySelectorAll('pre').forEach(preElement => {
                    const codeElement = preElement.querySelector('code');
                    if (codeElement) {
                        const copyButton = document.createElement('button');
                        copyButton.className = 'copy-button';
                        // Use text initially, icons will be added by lucide if available
                        copyButton.textContent = 'Copy';
                        preElement.appendChild(copyButton);

                        // Try adding icon if lucide is available
                        if (typeof lucide !== 'undefined') {
                             copyButton.innerHTML = '<i data-lucide="copy" class="lucide"></i> Copy';
                             lucide.createIcons({ nodes: [copyButton], attrs: {'icon-name': 'copy'}, nameAttr: 'data-lucide'});
                        }

                        copyButton.addEventListener('click', () => {
                            const codeToCopy = codeElement.innerText;
                            navigator.clipboard.writeText(codeToCopy).then(() => {
                                copyButton.textContent = 'Copied!'; // Text fallback
                                copyButton.classList.add('copied');
                                if (typeof lucide !== 'undefined') {
                                    copyButton.innerHTML = '<i data-lucide="check" class="lucide"></i> Copied!';
                                    lucide.createIcons({ nodes: [copyButton], attrs: {'icon-name': 'check'}, nameAttr: 'data-lucide'});
                                }

                                setTimeout(() => {
                                    copyButton.textContent = 'Copy'; // Text fallback
                                    copyButton.classList.remove('copied');
                                    if (typeof lucide !== 'undefined') {
                                        copyButton.innerHTML = '<i data-lucide="copy" class="lucide"></i> Copy';
                                        lucide.createIcons({ nodes: [copyButton], attrs: {'icon-name': 'copy'}, nameAttr: 'data-lucide'});
                                    }
                                }, 2000);
                            }).catch(err => {
                                console.error('Failed to copy text: ', err);
                                copyButton.textContent = 'Error';
                                setTimeout(() => {
                                    copyButton.textContent = 'Copy'; // Text fallback
                                     if (typeof lucide !== 'undefined') {
                                        copyButton.innerHTML = '<i data-lucide="copy" class="lucide"></i> Copy';
                                        lucide.createIcons({ nodes: [copyButton], attrs: {'icon-name': 'copy'}, nameAttr: 'data-lucide'});
                                    }
                                }, 2000);
                            });
                        });
                    }
                });
            } catch (error) {
                console.error("Error setting up copy code buttons:", error);
            }


            // --- Footer Date Update ---
            try {
                const generationDateElement = document.getElementById('generation-date');
                if (generationDateElement) {
                    generationDateElement.textContent = new Date().toLocaleDateString('en-US', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });
                }
                const currentYearElement = document.getElementById('current-year');
                 if (currentYearElement) {
                    currentYearElement.textContent = new Date().getFullYear();
                }
            } catch (error) {
                 console.error("Error updating footer dates:", error);
            }

        })(); // Immediately Invoked Function Expression (IIFE)

    </script>
</body>
</html>
